<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rắn Săn Mồi — Game Web</title>
<style>
:root{
--bg:#0f1724; --panel:#0b1220; --accent:#00d1b2; --muted:#94a3b8; --card:#0b1220;
}
*{box-sizing:border-box}
body{margin:0; font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial; background:linear-gradient(180deg,#07101a 0%, var(--bg) 100%); color:#e6eef6; display:flex; min-height:100vh; align-items:center; justify-content:center; padding:24px}
.wrap{width:100%; max-width:1000px; display:grid; grid-template-columns: 1fr 360px; gap:24px}
.card{background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); padding:18px; border-radius:12px; box-shadow: 0 6px 24px rgba(2,6,23,0.6)}
header{display:flex; align-items:center; justify-content:space-between; gap:12px}
h1{font-size:20px; margin:0; letter-spacing:0.2px}
p.lead{margin:6px 0 0; color:var(--muted); font-size:13px}


/* Game area */
.game-area{display:flex; align-items:center; justify-content:center; padding:12px}
canvas{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; width:100%; height:auto; max-height:720px; box-shadow: inset 0 2px 6px rgba(0,0,0,0.6)}
/* Side panel */
.panel h3{margin:0 0 10px}
.stats{display:flex; gap:12px; margin-bottom:12px}
.stat{flex:1; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); padding:12px; border-radius:8px; text-align:center}
.stat .val{font-size:20px; font-weight:700}
.controls{display:flex; flex-direction:column; gap:8px}
.btn{padding:10px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:600}
.btn.primary{background:linear-gradient(90deg,var(--accent), #00a896); color:#042022}
.btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted)}


.settings{margin-top:12px; background:rgba(255,255,255,0.01); padding:10px; border-radius:8px}
label{display:flex; justify-content:space-between; align-items:center; gap:10px; font-size:13px}
input[type=range]{width:100%}


/* Mobile controls */
.touch-controls{display:none; margin-top:12px; justify-content:center; gap:8px}
.dpad{display:grid; grid-template-columns:repeat(3,56px); grid-template-rows:repeat(3,56px); gap:6px}
.dpad button{width:56px;height:56px;border-radius:10px;border:none;background:rgba(255,255,255,0.03)}


footer{margin-top:10px; font-size:12px; color:var(--muted)}


@media (max-width:900px){
.wrap{grid-template-columns: 1fr;}
.touch-controls{display:flex}
}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<header>
<div>
<h1>Rắn Săn Mồi</h1>
<p class="lead">Điều khiển rắn ăn thức ăn, tránh va chạm. Hỗ trợ bàn phím & cảm ứng.</p>
</div>
<div style="text-align:right">
<div style="font-weight:700">Level <span id="level">1</span></div>
<div style="color:var(--muted); font-size:12px">Score: <span id="score">0</span></div>
</div>
</header>


<div class="game-area" style="margin-top:12px">
<canvas id="game" width="640" height="640"></canvas>
</div>


<footer>
<div style="display:flex; justify-content:space-between; align-items:center">
<div style="font-size:13px; color:var(--muted)">By — ChatGPT demo</div>
<div style="font-size:13px; color:var(--muted)">Use arrows / WASD or touch D-Pad</div>
</div>
</footer>
</div>


<div class="card panel">
<h3>Điều khiển & Thống kê</h3>
<div class="stats">
<div class="stat">
<div style="color:var(--muted); font-size:12px">Điểm</div>
<div class="val" id="statScore">0</div>
</div>
<div class="stat">
<div style="color:var(--muted); font-size:12px">Độ dài</div>
<div class="val" id="statLen">1</div>
</div>
</div>
<div class="controls">
<button class="btn primary" id="startBtn">Bắt đầu / Tiếp tục</button>
<button class="btn ghost" id="pauseBtn">Tạm dừng</button>
<button class="btn" id="restartBtn" style="background:rgba(255,255,255,0.03)">Khởi động lại</button>
</div>


<div class="settings">
<div style="margin-bottom:8px; font-size:13px; color:var(--muted)">Tốc độ</div>
<label>
<span style="font-size:13px">Chậm</span>
<input id="speedRange" type="range" min="4" max="20" value="8">
<span style="font-size:13px">Nhanh</span>
</label>
<div style="margin-top:10px; display:flex; gap:8px; align-items:center">
<label style="flex:1">Âm thanh <input id="soundChk" type="checkbox" checked></label>
<label style="flex:1">Hiện lưới <input id="gridChk" type="checkbox"></label>
</div>
</div>


<!-- Touch D-pad for mobile -->
<div class="touch-controls">
<div class="dpad" id="dpad">
<button data-d="" disabled></button>
<button data-d="up">▲</button>
<button data-d="" disabled></button>
<button data-d="left">◀</button>
<button data-d="ok">•</button>
<button data-d="right">▶</button>
<button data-d="" disabled></button>
<button data-d="down">▼</button>
<button data-d="" disabled></button>
</div>
</div>


<div style="margin-top:12px; font-size:13px; color:var(--muted)">Mẹo: ăn càng nhiều điểm càng cao. Va chạm vào mình hoặc biên sẽ thua.</div>
</div>
</div>


<script>
// --- Game constants ---
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let gridSize = 32; // ô nét
let cols = canvas.width / gridSize;
let rows = canvas.height / gridSize;


// --- Game state ---
let snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
let dir = {x:1, y:0};
let nextDir = {...dir};
let food = null;
let score = 0;
let level = 1;
let running = false;
let tick = 0;
let speed = 8; // ticks per second
let showGrid = false;
let soundOn = true;
// DOM
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const restartBtn = document.getElementById('restartBtn');
const speedRange = document.getElementById('speedRange');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const statScore = document.getElementById('statScore');
const statLen = document.getElementById('statLen');
const gridChk = document.getElementById('gridChk');
const soundChk = document.getElementById('soundChk');


// --- Helpers ---
function randPos(){
return {x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows)};
}


function placeFood(){
let p;
do{
p = randPos();
}while(snake.some(s=>s.x===p.x && s.y===p.y));
food = p;
}


function playTone(freq, duration=80){
if(!soundOn) return;
try{
const ctxAudio = new (window.AudioContext||window.webkitAudioContext)();
const o = ctxAudio.createOscillator();
const g = ctxAudio.createGain();
o.connect(g); g.connect(ctxAudio.destination);
o.type = 'sine'; o.frequency.value = freq; g.gain.value = 0.05;
o.start(); setTimeout(()=>{o.stop(); ctxAudio.close();}, duration);
}catch(e){}
}


// --- Game logic ---
function resetGame(){
snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
dir = {x:1,y:0}; nextDir = {...dir};
score = 0; level = 1; speed = parseInt(speedRange.value);
running = false; tick = 0; placeFood(); updateUI();
}


function updateUI(){
scoreEl.textContent = score;
levelEl.textContent = level;
statScore.textContent = score;
statLen.textContent = snake.length;
}
function step(){
// move snake at game tick
const head = {...snake[0]};
dir = nextDir; // accept the next direction when stepping
head.x += dir.x; head.y += dir.y;


// wall collision -> game over
if(head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows){
gameOver(); return;
}


// self collision
if(snake.some(s=>s.x===head.x && s.y===head.y)){
gameOver(); return;
}


snake.unshift(head);


// eat food
if(head.x===food.x && head.y===food.y){
score += 10; playTone(900,100);
// speed up every 5 eats
if(score % 50 === 0) { level++; speed = Math.min(24, speed + 2); }
placeFood();
} else {
snake.pop();
}


updateUI();
}


function gameOver(){
running = false;
playTone(120,300);
alert('Thua rồi! Điểm: ' + score + '\nNhấn Bắt đầu để chơi lại.');
}


// --- Render ---
function draw(){
// background
ctx.fillStyle = '#081129';
ctx.fillRect(0,0,canvas.width,canvas.height);


// grid
if(showGrid){
ctx.strokeStyle = 'rgba(255,255,255,0.02)'; ctx.lineWidth=1;
for(let x=0;x<cols;x++){
ctx.beginPath(); ctx.moveTo(x*gridSize,0); ctx.lineTo(x*gridSize,canvas.height); ctx.stroke();
}
for(let y=0;y<rows;y++){
ctx.beginPath(); ctx.moveTo(0,y*gridSize); ctx.lineTo(canvas.width,y*gridSize); ctx.stroke();
}
}
// food
ctx.fillStyle = '#ff6363';
ctx.beginPath();
const fx = food.x*gridSize + gridSize/2;
const fy = food.y*gridSize + gridSize/2;
ctx.arc(fx,fy, gridSize*0.35, 0, Math.PI*2);
ctx.fill();


// snake body
for(let i=snake.length-1;i>=0;i--){
const s = snake[i];
const x = s.x*gridSize + 2;
const y = s.y*gridSize + 2;
const w = gridSize - 4;
const h = gridSize - 4;
// gradient color from tail to head
const t = i/snake.length;
const r = Math.floor(20 + (0)*(1-t)*200);
ctx.fillStyle = `rgba(${Math.floor(0 + 0*(1-t))}, ${Math.floor(210 - t*80)}, ${Math.floor(178 - t*120)}, 1)`;
ctx.fillRect(x,y,w,h);
}


// shiny head
const head = snake[0];
ctx.fillStyle = '#00ffd0';
ctx.fillRect(head.x*gridSize+4, head.y*gridSize+4, gridSize-8, gridSize-8);


requestAnimationFrame(draw);
}


// --- Input ---
const keyMap = {
'ArrowUp': {x:0,y:-1}, 'ArrowDown':{x:0,y:1}, 'ArrowLeft':{x:-1,y:0}, 'ArrowRight':{x:1,y:0},
'w': {x:0,y:-1}, 's':{x:0,y:1}, 'a':{x:-1,y:0}, 'd':{x:1,y:0}
};


window.addEventListener('keydown', e=>{
const k = e.key;
const m = keyMap[k];
if(m){
// prevent reverse
if(m.x === -dir.x && m.y === -dir.y) return;
nextDir = m;
}
if(k===' '){ running = !running; }
});


// touch dpad
document.getElementById('dpad').addEventListener('click', e=>{
const d = e.target.dataset.d;
if(!d) return;
if(d==='ok') { running = !running; return; }
const map = {up:{x:0,y:-1}, down:{x:0,y:1}, left:{x:-1,y:0}, right:{x:1,y:0}};
const m = map[d];
if(m){ if(m.x === -dir.x && m.y === -dir.y) return; nextDir = m; }
});
// UI actions
startBtn.addEventListener('click', ()=>{ running = true; });
pauseBtn.addEventListener('click', ()=>{ running = false; });
restartBtn.addEventListener('click', ()=>{ resetGame(); running = true; });
speedRange.addEventListener('input', ()=>{ speed = parseInt(speedRange.value); });
gridChk.addEventListener('change', ()=>{ showGrid = gridChk.checked; });
soundChk.addEventListener('change', ()=>{ soundOn = soundChk.checked; });


// --- Game loop (timer) ---
let last = performance.now();
function loop(now){
const delta = now - last;
const interval = 1000 / speed;
if(running){
tick += delta;
while(tick >= interval){ step(); tick -= interval; }
}
last = now;
requestAnimationFrame(loop);
}


// init
placeFood(); updateUI(); draw(); resetCanvasSize();
function resetCanvasSize(){
// ensure grid fits in canvas and is responsive
const minSide = Math.min(window.innerWidth - 120, 720);
canvas.width = minSide - (minSide % gridSize);
canvas.height = canvas.width;
cols = canvas.width / gridSize; rows = canvas.height / gridSize;
resetGame();
}
window.addEventListener('resize', ()=>{ resetCanvasSize(); });


// start timer
requestAnimationFrame(loop);
</script>
</body>
</html>